{"ast":null,"code":"'use strict';\n\nvar MapiResponse = require('../classes/mapi-response');\n\nvar MapiError = require('../classes/mapi-error');\n\nvar constants = require('../constants');\n\nvar parseHeaders = require('../helpers/parse-headers'); // Keys are request IDs, values are XHRs.\n\n\nvar requestsUnderway = {};\n\nfunction browserAbort(request) {\n  var xhr = requestsUnderway[request.id];\n  if (!xhr) return;\n  xhr.abort();\n  delete requestsUnderway[request.id];\n}\n\nfunction createResponse(request, xhr) {\n  return new MapiResponse(request, {\n    body: xhr.response,\n    headers: parseHeaders(xhr.getAllResponseHeaders()),\n    statusCode: xhr.status\n  });\n}\n\nfunction normalizeBrowserProgressEvent(event) {\n  var total = event.total;\n  var transferred = event.loaded;\n  var percent = 100 * transferred / total;\n  return {\n    total: total,\n    transferred: transferred,\n    percent: percent\n  };\n}\n\nfunction sendRequestXhr(request, xhr) {\n  return new Promise(function (resolve, reject) {\n    xhr.onprogress = function (event) {\n      request.emitter.emit(constants.EVENT_PROGRESS_DOWNLOAD, normalizeBrowserProgressEvent(event));\n    };\n\n    var file = request.file;\n\n    if (file) {\n      xhr.upload.onprogress = function (event) {\n        request.emitter.emit(constants.EVENT_PROGRESS_UPLOAD, normalizeBrowserProgressEvent(event));\n      };\n    }\n\n    xhr.onerror = function (error) {\n      reject(error);\n    };\n\n    xhr.onabort = function () {\n      var mapiError = new MapiError({\n        request: request,\n        type: constants.ERROR_REQUEST_ABORTED\n      });\n      reject(mapiError);\n    };\n\n    xhr.onload = function () {\n      delete requestsUnderway[request.id];\n\n      if (xhr.status < 200 || xhr.status >= 400) {\n        var mapiError = new MapiError({\n          request: request,\n          body: xhr.response,\n          statusCode: xhr.status\n        });\n        reject(mapiError);\n        return;\n      }\n\n      resolve(xhr);\n    };\n\n    var body = request.body; // matching service needs to send a www-form-urlencoded request\n\n    if (typeof body === 'string') {\n      xhr.send(body);\n    } else if (body) {\n      xhr.send(JSON.stringify(body));\n    } else if (file) {\n      xhr.send(file);\n    } else {\n      xhr.send();\n    }\n\n    requestsUnderway[request.id] = xhr;\n  }).then(function (xhr) {\n    return createResponse(request, xhr);\n  });\n} // The accessToken argument gives this function flexibility\n// for Mapbox's internal client.\n\n\nfunction createRequestXhr(request, accessToken) {\n  var url = request.url(accessToken);\n  var xhr = new window.XMLHttpRequest();\n  xhr.open(request.method, url);\n  Object.keys(request.headers).forEach(function (key) {\n    xhr.setRequestHeader(key, request.headers[key]);\n  });\n  return xhr;\n}\n\nfunction browserSend(request) {\n  return Promise.resolve().then(function () {\n    var xhr = createRequestXhr(request, request.client.accessToken);\n    return sendRequestXhr(request, xhr);\n  });\n}\n\nmodule.exports = {\n  browserAbort: browserAbort,\n  sendRequestXhr: sendRequestXhr,\n  browserSend: browserSend,\n  createRequestXhr: createRequestXhr\n};","map":{"version":3,"names":["MapiResponse","require","MapiError","constants","parseHeaders","requestsUnderway","browserAbort","request","xhr","id","abort","createResponse","body","response","headers","getAllResponseHeaders","statusCode","status","normalizeBrowserProgressEvent","event","total","transferred","loaded","percent","sendRequestXhr","Promise","resolve","reject","onprogress","emitter","emit","EVENT_PROGRESS_DOWNLOAD","file","upload","EVENT_PROGRESS_UPLOAD","onerror","error","onabort","mapiError","type","ERROR_REQUEST_ABORTED","onload","send","JSON","stringify","then","createRequestXhr","accessToken","url","window","XMLHttpRequest","open","method","Object","keys","forEach","key","setRequestHeader","browserSend","client","module","exports"],"sources":["D:/Github/mobx/multiple-mobx/node_modules/@mapbox/mapbox-sdk/lib/browser/browser-layer.js"],"sourcesContent":["'use strict';\n\nvar MapiResponse = require('../classes/mapi-response');\nvar MapiError = require('../classes/mapi-error');\nvar constants = require('../constants');\nvar parseHeaders = require('../helpers/parse-headers');\n\n// Keys are request IDs, values are XHRs.\nvar requestsUnderway = {};\n\nfunction browserAbort(request) {\n  var xhr = requestsUnderway[request.id];\n  if (!xhr) return;\n  xhr.abort();\n  delete requestsUnderway[request.id];\n}\n\nfunction createResponse(request, xhr) {\n  return new MapiResponse(request, {\n    body: xhr.response,\n    headers: parseHeaders(xhr.getAllResponseHeaders()),\n    statusCode: xhr.status\n  });\n}\n\nfunction normalizeBrowserProgressEvent(event) {\n  var total = event.total;\n  var transferred = event.loaded;\n  var percent = (100 * transferred) / total;\n  return {\n    total: total,\n    transferred: transferred,\n    percent: percent\n  };\n}\n\nfunction sendRequestXhr(request, xhr) {\n  return new Promise(function(resolve, reject) {\n    xhr.onprogress = function(event) {\n      request.emitter.emit(\n        constants.EVENT_PROGRESS_DOWNLOAD,\n        normalizeBrowserProgressEvent(event)\n      );\n    };\n\n    var file = request.file;\n    if (file) {\n      xhr.upload.onprogress = function(event) {\n        request.emitter.emit(\n          constants.EVENT_PROGRESS_UPLOAD,\n          normalizeBrowserProgressEvent(event)\n        );\n      };\n    }\n\n    xhr.onerror = function(error) {\n      reject(error);\n    };\n\n    xhr.onabort = function() {\n      var mapiError = new MapiError({\n        request: request,\n        type: constants.ERROR_REQUEST_ABORTED\n      });\n      reject(mapiError);\n    };\n\n    xhr.onload = function() {\n      delete requestsUnderway[request.id];\n      if (xhr.status < 200 || xhr.status >= 400) {\n        var mapiError = new MapiError({\n          request: request,\n          body: xhr.response,\n          statusCode: xhr.status\n        });\n        reject(mapiError);\n        return;\n      }\n      resolve(xhr);\n    };\n\n    var body = request.body;\n\n    // matching service needs to send a www-form-urlencoded request\n    if (typeof body === 'string') {\n      xhr.send(body);\n    } else if (body) {\n      xhr.send(JSON.stringify(body));\n    } else if (file) {\n      xhr.send(file);\n    } else {\n      xhr.send();\n    }\n\n    requestsUnderway[request.id] = xhr;\n  }).then(function(xhr) {\n    return createResponse(request, xhr);\n  });\n}\n\n// The accessToken argument gives this function flexibility\n// for Mapbox's internal client.\nfunction createRequestXhr(request, accessToken) {\n  var url = request.url(accessToken);\n  var xhr = new window.XMLHttpRequest();\n  xhr.open(request.method, url);\n  Object.keys(request.headers).forEach(function(key) {\n    xhr.setRequestHeader(key, request.headers[key]);\n  });\n  return xhr;\n}\n\nfunction browserSend(request) {\n  return Promise.resolve().then(function() {\n    var xhr = createRequestXhr(request, request.client.accessToken);\n    return sendRequestXhr(request, xhr);\n  });\n}\n\nmodule.exports = {\n  browserAbort: browserAbort,\n  sendRequestXhr: sendRequestXhr,\n  browserSend: browserSend,\n  createRequestXhr: createRequestXhr\n};\n"],"mappings":"AAAA;;AAEA,IAAIA,YAAY,GAAGC,OAAO,CAAC,0BAAD,CAA1B;;AACA,IAAIC,SAAS,GAAGD,OAAO,CAAC,uBAAD,CAAvB;;AACA,IAAIE,SAAS,GAAGF,OAAO,CAAC,cAAD,CAAvB;;AACA,IAAIG,YAAY,GAAGH,OAAO,CAAC,0BAAD,CAA1B,C,CAEA;;;AACA,IAAII,gBAAgB,GAAG,EAAvB;;AAEA,SAASC,YAAT,CAAsBC,OAAtB,EAA+B;EAC7B,IAAIC,GAAG,GAAGH,gBAAgB,CAACE,OAAO,CAACE,EAAT,CAA1B;EACA,IAAI,CAACD,GAAL,EAAU;EACVA,GAAG,CAACE,KAAJ;EACA,OAAOL,gBAAgB,CAACE,OAAO,CAACE,EAAT,CAAvB;AACD;;AAED,SAASE,cAAT,CAAwBJ,OAAxB,EAAiCC,GAAjC,EAAsC;EACpC,OAAO,IAAIR,YAAJ,CAAiBO,OAAjB,EAA0B;IAC/BK,IAAI,EAAEJ,GAAG,CAACK,QADqB;IAE/BC,OAAO,EAAEV,YAAY,CAACI,GAAG,CAACO,qBAAJ,EAAD,CAFU;IAG/BC,UAAU,EAAER,GAAG,CAACS;EAHe,CAA1B,CAAP;AAKD;;AAED,SAASC,6BAAT,CAAuCC,KAAvC,EAA8C;EAC5C,IAAIC,KAAK,GAAGD,KAAK,CAACC,KAAlB;EACA,IAAIC,WAAW,GAAGF,KAAK,CAACG,MAAxB;EACA,IAAIC,OAAO,GAAI,MAAMF,WAAP,GAAsBD,KAApC;EACA,OAAO;IACLA,KAAK,EAAEA,KADF;IAELC,WAAW,EAAEA,WAFR;IAGLE,OAAO,EAAEA;EAHJ,CAAP;AAKD;;AAED,SAASC,cAAT,CAAwBjB,OAAxB,EAAiCC,GAAjC,EAAsC;EACpC,OAAO,IAAIiB,OAAJ,CAAY,UAASC,OAAT,EAAkBC,MAAlB,EAA0B;IAC3CnB,GAAG,CAACoB,UAAJ,GAAiB,UAAST,KAAT,EAAgB;MAC/BZ,OAAO,CAACsB,OAAR,CAAgBC,IAAhB,CACE3B,SAAS,CAAC4B,uBADZ,EAEEb,6BAA6B,CAACC,KAAD,CAF/B;IAID,CALD;;IAOA,IAAIa,IAAI,GAAGzB,OAAO,CAACyB,IAAnB;;IACA,IAAIA,IAAJ,EAAU;MACRxB,GAAG,CAACyB,MAAJ,CAAWL,UAAX,GAAwB,UAAST,KAAT,EAAgB;QACtCZ,OAAO,CAACsB,OAAR,CAAgBC,IAAhB,CACE3B,SAAS,CAAC+B,qBADZ,EAEEhB,6BAA6B,CAACC,KAAD,CAF/B;MAID,CALD;IAMD;;IAEDX,GAAG,CAAC2B,OAAJ,GAAc,UAASC,KAAT,EAAgB;MAC5BT,MAAM,CAACS,KAAD,CAAN;IACD,CAFD;;IAIA5B,GAAG,CAAC6B,OAAJ,GAAc,YAAW;MACvB,IAAIC,SAAS,GAAG,IAAIpC,SAAJ,CAAc;QAC5BK,OAAO,EAAEA,OADmB;QAE5BgC,IAAI,EAAEpC,SAAS,CAACqC;MAFY,CAAd,CAAhB;MAIAb,MAAM,CAACW,SAAD,CAAN;IACD,CAND;;IAQA9B,GAAG,CAACiC,MAAJ,GAAa,YAAW;MACtB,OAAOpC,gBAAgB,CAACE,OAAO,CAACE,EAAT,CAAvB;;MACA,IAAID,GAAG,CAACS,MAAJ,GAAa,GAAb,IAAoBT,GAAG,CAACS,MAAJ,IAAc,GAAtC,EAA2C;QACzC,IAAIqB,SAAS,GAAG,IAAIpC,SAAJ,CAAc;UAC5BK,OAAO,EAAEA,OADmB;UAE5BK,IAAI,EAAEJ,GAAG,CAACK,QAFkB;UAG5BG,UAAU,EAAER,GAAG,CAACS;QAHY,CAAd,CAAhB;QAKAU,MAAM,CAACW,SAAD,CAAN;QACA;MACD;;MACDZ,OAAO,CAAClB,GAAD,CAAP;IACD,CAZD;;IAcA,IAAII,IAAI,GAAGL,OAAO,CAACK,IAAnB,CA5C2C,CA8C3C;;IACA,IAAI,OAAOA,IAAP,KAAgB,QAApB,EAA8B;MAC5BJ,GAAG,CAACkC,IAAJ,CAAS9B,IAAT;IACD,CAFD,MAEO,IAAIA,IAAJ,EAAU;MACfJ,GAAG,CAACkC,IAAJ,CAASC,IAAI,CAACC,SAAL,CAAehC,IAAf,CAAT;IACD,CAFM,MAEA,IAAIoB,IAAJ,EAAU;MACfxB,GAAG,CAACkC,IAAJ,CAASV,IAAT;IACD,CAFM,MAEA;MACLxB,GAAG,CAACkC,IAAJ;IACD;;IAEDrC,gBAAgB,CAACE,OAAO,CAACE,EAAT,CAAhB,GAA+BD,GAA/B;EACD,CA1DM,EA0DJqC,IA1DI,CA0DC,UAASrC,GAAT,EAAc;IACpB,OAAOG,cAAc,CAACJ,OAAD,EAAUC,GAAV,CAArB;EACD,CA5DM,CAAP;AA6DD,C,CAED;AACA;;;AACA,SAASsC,gBAAT,CAA0BvC,OAA1B,EAAmCwC,WAAnC,EAAgD;EAC9C,IAAIC,GAAG,GAAGzC,OAAO,CAACyC,GAAR,CAAYD,WAAZ,CAAV;EACA,IAAIvC,GAAG,GAAG,IAAIyC,MAAM,CAACC,cAAX,EAAV;EACA1C,GAAG,CAAC2C,IAAJ,CAAS5C,OAAO,CAAC6C,MAAjB,EAAyBJ,GAAzB;EACAK,MAAM,CAACC,IAAP,CAAY/C,OAAO,CAACO,OAApB,EAA6ByC,OAA7B,CAAqC,UAASC,GAAT,EAAc;IACjDhD,GAAG,CAACiD,gBAAJ,CAAqBD,GAArB,EAA0BjD,OAAO,CAACO,OAAR,CAAgB0C,GAAhB,CAA1B;EACD,CAFD;EAGA,OAAOhD,GAAP;AACD;;AAED,SAASkD,WAAT,CAAqBnD,OAArB,EAA8B;EAC5B,OAAOkB,OAAO,CAACC,OAAR,GAAkBmB,IAAlB,CAAuB,YAAW;IACvC,IAAIrC,GAAG,GAAGsC,gBAAgB,CAACvC,OAAD,EAAUA,OAAO,CAACoD,MAAR,CAAeZ,WAAzB,CAA1B;IACA,OAAOvB,cAAc,CAACjB,OAAD,EAAUC,GAAV,CAArB;EACD,CAHM,CAAP;AAID;;AAEDoD,MAAM,CAACC,OAAP,GAAiB;EACfvD,YAAY,EAAEA,YADC;EAEfkB,cAAc,EAAEA,cAFD;EAGfkC,WAAW,EAAEA,WAHE;EAIfZ,gBAAgB,EAAEA;AAJH,CAAjB"},"metadata":{},"sourceType":"script"}